# دليل نظام الموافقة على الحسابات الجديدة

## 🔒 نظام الأمان الجديد

تم تطوير نظام أمان متقدم لحماية النظام من الوصول غير المصرح به. الآن **جميع الحسابات الجديدة تتطلب موافقة المدير** قبل السماح بالوصول للنظام.

---

## 📋 للمستخدمين الجدد

### 1. إنشاء حساب جديد
1. اذهب إلى صفحة **إنشاء حساب جديد** من صفحة تسجيل الدخول
2. املأ جميع البيانات المطلوبة:
   - **اسم الشركة/المؤسسة**
   - **أرقام الهواتف** (واحد على الأقل)
   - **اسم المستخدم** (للدخول للنظام)
   - **كلمة المرور** (6 أحرف على الأقل)
   - **تأكيد كلمة المرور**
   - **نوع الحساب** (مدير النظام أو موظف نقطة بيع)

### 2. بعد إنشاء الحساب
- ستظهر لك رسالة تأكيد: **"تم إنشاء الطلب بنجاح! سيتم مراجعة حسابك من قبل المدير قريباً"**
- حالة حسابك ستكون: **"قيد المراجعة"**
- **لا يمكنك تسجيل الدخول** حتى يتم الموافقة على حسابك

### 3. انتظار الموافقة
- سيتم إشعار المدير بطلبك الجديد
- المدير سيراجع بياناتك ويتخذ قرار الموافقة أو الرفض
- ستصل إليك رسالة واضحة عند محاولة تسجيل الدخول

---

## 🎯 للمديرين

### 1. إشعارات الحسابات المعلقة
- ستظهر لك إشعارات في **لوحة التحكم الرئيسية** عند وجود حسابات معلقة
- عدد الحسابات المعلقة سيظهر بوضوح مع زر للانتقال لصفحة الإدارة

### 2. إدارة الحسابات المعلقة
- اذهب إلى **إدارة الحسابات** من القائمة الجانبية
- ستجد 4 بطاقات إحصائية:
  - **في الانتظار**: الحسابات التي تحتاج مراجعة
  - **موافق عليها**: الحسابات المعتمدة
  - **مرفوضة**: الحسابات المرفوضة
  - **إجمالي**: إجمالي الحسابات في النظام

### 3. مراجعة الحسابات
كل حساب معلق سيعرض:
- **اسم المستخدم**
- **نوع الحساب المطلوب** (مدير أو موظف نقطة بيع)
- **اسم الشركة/المؤسسة**
- **أرقام الهواتف**
- **تاريخ الطلب**

### 4. اتخاذ القرار
لكل حساب معلق يمكنك:
- **الموافقة**: السماح للمستخدم بالوصول للنظام
- **الرفض**: منع المستخدم من الوصول مع رسالة واضحة

---

## 📊 حالات الحسابات

### 🟡 قيد المراجعة (Pending)
- **الوصف**: حساب جديد ينتظر موافقة المدير
- **الوصول**: **محظور** - لا يمكن تسجيل الدخول
- **الرسالة**: "حسابك قيد المراجعة من قبل المدير"

### 🟢 معتمد (Approved)
- **الوصف**: حساب تم الموافقة عليه من قبل المدير
- **الوصول**: **مسموح** - يمكن تسجيل الدخول بشكل طبيعي
- **المميزات**: وصول كامل لجميع الميزات حسب نوع الحساب

### 🔴 مرفوض (Rejected)
- **الوصف**: حساب تم رفضه من قبل المدير
- **الوصول**: **محظور** - لا يمكن تسجيل الدخول
- **الرسالة**: "تم رفض طلب حسابك من قبل المدير"

---

## 🛠️ للمطورين والمسؤولين التقنيين

### 1. تحديث قاعدة البيانات
```sql
-- تشغيل هذا الأمر لتحديث قاعدة البيانات الحالية
mysql -u username -p database_name < backend/db_update_user_approval.sql
```

### 2. المستخدمون الحاليون
- **جميع المستخدمين الحاليين** تم تعيين حالتهم تلقائياً إلى **"معتمد"**
- لا يتأثر المستخدمون الحاليون بالتحديث الجديد

### 3. API الجديدة
- `GET /api/auth/pending-users` - جلب الحسابات المعلقة
- `POST /api/auth/approve-user` - الموافقة على حساب
- `POST /api/auth/reject-user` - رفض حساب
- `GET /api/auth/approval-stats` - إحصائيات الموافقة

---

## 🔧 استكشاف الأخطاء

### مشكلة: لا يمكن تسجيل الدخول بعد إنشاء الحساب
**الحل**: هذا طبيعي! حسابك يحتاج موافقة المدير أولاً.

### مشكلة: رسالة "حسابك قيد المراجعة"
**الحل**: انتظر حتى يراجع المدير حسابك ويوافق عليه.

### مشكلة: رسالة "تم رفض طلب حسابك"
**الحل**: تواصل مع المدير لمعرفة سبب الرفض.

### مشكلة: المدير لا يرى الحسابات المعلقة
**الحل**: 
1. تأكد من أن المدير يستخدم حساب من نوع "مدير النظام"
2. تحقق من تحديث قاعدة البيانات بشكل صحيح

---

## ⚠️ ملاحظات مهمة

1. **الأمان أولاً**: هذا النظام يحمي شركتك من الوصول غير المصرح به
2. **للمديرين فقط**: فقط المديرون يمكنهم الموافقة على الحسابات الجديدة
3. **لا تشارك بيانات المدير**: كلمة مرور المدير يجب أن تبقى سرية
4. **راجع الطلبات بانتظام**: تحقق من صفحة إدارة الحسابات يومياً

---

## 📞 الدعم الفني

إذا واجهت أي مشاكل تقنية، يرجى التواصل مع فريق الدعم الفني مع ذكر:
- **نوع المشكلة**
- **رسالة الخطأ** (إن وجدت)
- **خطوات إعادة إنتاج المشكلة**
- **معلومات المستخدم** (اسم المستخدم، نوع الحساب)

---

**تم تطوير هذا النظام لضمان أقصى درجات الأمان والحماية لبيانات شركتك.** 